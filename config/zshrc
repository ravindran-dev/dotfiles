# =========================================
# Zsh Configuration by Ravindran S
# For Arch Linux + Powerlevel10k setup
# ========================================

fastfetch
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi


[[ $- != *i* ]] && return

plugins=(
  git
  zsh-autosuggestions
  zsh-syntax-highlighting
)
#source ${ZSH_CUSTOM:-~/.zsh}/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh
#source ${ZSH_CUSTOM:-~/.zsh}/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh

autoload -Uz compinit
compinit
zstyle ':completion:*' menu select
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'
zstyle ':completion:*:default' list-colors ${(s.:.)LS_COLORS}
zstyle ':completion:*' rehash true


ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=#888888'
#source ~/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh
alias cls='clear'
alias sdn='shutdown now'
alias ex='exit'
alias ls='ls --color=auto'
alias grep='grep --color=auto'
alias showimg='display_image'
alias update='sudo pacman -Syu'
alias la='ls -a'
alias ll='ls -alh'
alias cat='bat'
alias chatgpt='source /home/ravi/chatgpt-env/bin/activate && chmod +x chat.py && ./chat.py'
alias metrics= 'sys'
# Git
alias gs='git status'
alias ga='git add .'
alias gc='git commit -m'
alias gp='git push'
alias gl='git pull'
alias gb='git branch'
alias gd='git diff'


: <<'END_COMMENT'
precmd() { vcs_info }
setopt prompt_subst
autoload -Uz vcs_info
precmd() { vcs_info }



autoload -Uz vcs_info
autoload -U colors && colors

zstyle ':vcs_info:git:*' formats "%F{magenta}   %b%f"
zstyle ':vcs_info:git:*' actionformats "%F{red}   %b|%a%f"
zstyle ':vcs_info:*' enable git


typeset -ga symbols=( "󱞩" "󱞩" "󱞩" "󱞩" "󱞩" "󱞩" )
typeset -gi idx=1

precmd() {
  vcs_info
  PROMPT="
%F{yellow}%D{%H:%M}%f %F{cyan}%n@%m %F{blue}%~%f ${vcs_info_msg_0_}
%F{magenta}${symbols[$idx]}%f "
  (( idx = (idx % ${#symbols[@]}) + 1 ))
}

precmd
END_COMMENT

if [[ $interactiveShellTest > 0 ]]; then bind "set completion-ignore-case on"; fi

setopt APPEND_HISTORY
setopt SHARE_HISTORY
setopt HIST_EXPIRE_DUPS_FIRST
setopt INC_APPEND_HISTORY
HISTFILE=~/.zsh_history
HISTSIZE=1000
SAVEHIST=1000

autoload -U up-line-or-beginning-search
autoload -U down-line-or-beginning-search


bindkey '^[[A' history-beginning-search-backward
bindkey '^[[B' history-beginning-search-forward


bindkey "${terminfo[kcuu1]}" up-line-or-beginning-search
bindkey "${terminfo[kcud1]}" down-line-or-beginning-search
bindkey "${terminfo[kcuu1]}" backward-history
bindkey "${terminfo[kcud1]}" forward-history
autoload -U compinit
compinit
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Za-z}'
zstyle ':completion:*' menu selec

zstyle ':completion:*' group-name ''
zstyle ':completion:*:descriptions' format '%F{yellow}-- %d --%f'
zstyle ':completion:*:messages' format '%F{red}-- %d --%f'
zstyle ':completion:*:warnings' format '%F{red}no matches for: %d%f'
zstyle ':completion:*:corrections' format '%F{green}[%d]%f'


zstyle ':completion:*' matcher-list 'm:{a-z}={A-Za-z}'
setopt correct_all

setopt auto_cd
setopt auto_pushd
setopt autoparamslash

sys() {

    echo "Activating virtual environment..."

    if [ -f "/home/ravi/sys/bin/activate" ]; then
        source /home/ravi/sys/bin/activate
        echo "Environment activated. Starting application..."

        sysdash
        deactivate
        echo "Application stopped and venv deactivated."
    else
        echo "Error: venv/bin/activate not found. Are you in the right directory?"
    fi
}


display_image() {
    if command -v chafa &> /dev/null; then
        chafa "$1"
    elif command -v img2sixel &> /dev/null; then
        img2sixel "$1"
    else
        echo "Image viewer not found. Please install chafa or img2sixel."
    fi
}

source ~/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh
source ~/.zsh/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh


typeset -g POWERLEVEL9K_INSTANT_PROMPT=quiet
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh


export PATH="$PATH:/home/ravi/.local/bin"

export OPENAI_KEY="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"

#typeset -g POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(cpu_load ram battery time)

source ~/.zsh/powerlevel10k/powerlevel10k.zsh-theme
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh



notify_long_command() {
  if (( SECONDS > 10 )); then
    if [[ $? -eq 0 ]]; then
      notify-send "Command completed successfully in $SECONDS s" "$(fc -ln -1)"
      canberra-gtk-play -i complete >/dev/null 2>&1 &!
    else
      notify-send "Command failed after $SECONDS s" "$(fc -ln -1)"
      canberra-gtk-play -i message-new-email >/dev/null 2>&1 &!
    fi
  fi
}

preexec() { SECONDS=0 }
precmd() { notify_long_command }

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"

